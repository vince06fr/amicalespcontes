{% load i18n %}

<div class="calendar">
  <div class="calendar-heading">
    <h3 class="calendar-title">{{ title }}</h3>

    <div class="calendar-nav">
      {% if prev %}
        <a href="{{ prev }}">{% trans "Previous month" %}</a>
      {% endif %}

      <span class="calendar-date">{{ calendar_date|date:'m.Y' }}</span>

      {% if next %}
        <a href="{{ next }}">{% trans "Next month" %}</a>
      {% endif %}
    </div>
  </div>

  <div class="calendar-body">
    <table class="calendar-table">
      {% for row in grid %}
      <tr>
        {% for day in row %}
          {% if not day %}
            <td class="day noday"></td>
          {% else %}
            {% with day_day=day.0 day_events=day.1 link=day.2 is_today=day.3 %}
            <td class="day {% if day.1 %}day-has-events{% else %}day-no-events{% endif %}">
              {% if link %}
                <a href="{{ link }}" class="day-number">{{ day_day }}</a>
              {% else %}
                <span class="day-number">{{ day_day }}</span>
              {% endif %}
              {% if day_events %}
                <div class="day-event-list">
                  {% for event in day_events %}
                    {% with res=event.reservation %}
                    {% with arrival_time=res.heure_arrivee|time:"H:i" departure_time=res.heure_depart|time:"H:i" %}
                    <div class="day-event">
                      {% if event.date == res.date_debut %}
                        {% if arrival_time == '13:00' %}
                          {% with display_time='13h00' %}
                            {% if event.confirmed %}
                              <span style="background-color: #60da11; color: #000000;">{{ event }} (arrivée {{ display_time }})</span>
                            {% else %}
                              <span style="background-color: #f7b12f; color: #000000;">{{ event }} (arrivée {{ display_time }})</span>
                            {% endif %}
                          {% endwith %}
                        {% else %}
                          {% if event.confirmed %}
                            <span style="background-color: #60da11; color: #000000;">{{ event }} (arrivée {{ arrival_time }})</span>
                          {% else %}
                            <span style="background-color: #f7b12f; color: #000000;">{{ event }} (arrivée {{ arrival_time }})</span>
                          {% endif %}
                        {% endif %}
                      {% elif event.date == res.date_fin %}
                        {% if departure_time == '12:00' %}
                          {% with display_time='midi' %}
                            {% if event.confirmed %}
                              <span style="background-color: #60da11; color: #000000;">{{ event }} (départ {{ display_time }})</span>
                            {% else %}
                              <span style="background-color: #f7b12f; color: #000000;">{{ event }} (départ {{ display_time }})</span>
                            {% endif %}
                          {% endwith %}
                        {% else %}
                          {% if event.confirmed %}
                            <span style="background-color: #60da11; color: #000000;">{{ event }} (départ {{ departure_time }})</span>
                          {% else %}
                            <span style="background-color: #f7b12f; color: #000000;">{{ event }} (départ {{ departure_time }})</span>
                          {% endif %}
                        {% endif %}
                      {% else %}
                        {% if event.confirmed %}
                          <span style="background-color: #60da11; color: #000000;">{{ event }}</span>
                        {% else %}
                          <span style="background-color: #f7b12f; color: #000000;">{{ event }}</span>
                        {% endif %}
                      {% endif %}
                    </div>
                    {% endwith %}
                    {% endwith %}
                  {% endfor %}
                </div>
              {% endif %}
            </td>
            {% endwith %}
          {% endif %}
        {% endfor %}
      </tr>
      {% endfor %}
    </table>
  </div>
</div>
